
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/plugins/footable/footable.all.min.js"></script>
<link href="~/Content/footable/footable.core.css" rel="stylesheet" />
<div class="row">
    <div class="col-lg-3">
        <a href="#">
            <div class="widget style1 navy-bg">
                <div class="row">

                    <div class="col-xs-12 text-right">
                        <span style="font-size:18px;color:black;">Counties<br /> Registered</span>
                        <h2 style="color:black;" id="count">Loading...</h2>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="col-lg-3">
        <a href="#">
            <div class="widget style1 lazur-bg">
                <div class="row">

                    <div class="col-xs-12 text-right">
                        <span style="font-size:18px;color:black;"> School Types<br /> Registered</span>
                        <h2 style="color:black;" id="types">Loading...</h2>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="col-lg-3">
        <a href="#">
            <div class="widget style1 yellow-bg">
                <div class="row">

                    <div class="col-xs-12 text-right">
                        <span style="font-size:18px;color:black;">Number of Batches Created</span>
                        <h2 style="color:black;" id="batches">Loading...</h2>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="col-lg-3">
        <a href="#">
            <div class="widget style1 red-bg">
                <div class="row">
                    <div class="col-xs-12 text-right">
                        <span style="margin-left:25px;font-size:18px; margin-top:20px;color:black;"> Counties with Missing Batches </span>
                         <br /><button onclick="show()" style="float:right;color:black;" class="btn btn-danger">View List</button>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="col-lg-12" id="list">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <div class="row" class="form-group">
                    <div col-md-6>
                        <h5 style="margin-left: 25px; margin-top:10px;">List Of Batches Available for Voucher Creation</h5>
                    </div>
                    <div col-md-6>
                        <a href="CreateBatch/" style="float:right; margin-right:20px;" class="btn btn-primary">CREATE THESE BATCHES</a>
                    </div>
                </div>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="ibox-content">
            <div class="table-responsive">
                <table id="createdvouchers" style="text-align:left;" class="footable table table-stripped toggle-arrow-tiny">
                    <tr>
                        <th class="hidden"> ID </th>
                        <th> COUNTY NAME </th>
                        <th> COUNTY CODE</th>
                    <tr>
                    <tfoot>
                    <td colspan="5"> <ul class="pagination pull-right"></ul> </td>
                    </tfoot>
                </table>
            </div>
        </div>
        @section Styles {
            @Styles.Render("~/plugins/footableStyles")
        }
        @section Scripts {
            @Scripts.Render("~/plugins/footable")
            <script type="text/javascript">
                $(document).ready(function () {

                    $('.footable').footable();
                    $('.footable2').footable();

                });
            </script>
            <script type="text/javascript">

                $("#list").hide();

                function show() {
                    var x = document.getElementById("list");
                    if (x.style.display === "block") {
                        x.style.display = "none";
                    } else {
                        x.style.display = "block";
                    }
                }
            </script>
            <script type="text/JavaScript">
                function tableRows(data) {
                    var tableRows = [];
                    for (var i = 0; i < data.length; i++) {
                        tableRows.push(drawRow(data[i]));
                    }
                    return tableRows;
                };
                //Start by getting voucher list based on batch Id
                var d = new Date();
                var n = d.getFullYear();
                $.ajax({
                    url: `https://voucherapi.kec.ac.ke/api/counties/batch/pending/${n}`,
                    type: "GET",
                    dataType: "json",
                    success: function (data, status, jqhxr) {
                        console.log(data);

                        //This code snipet prepares to append Json Data
                        $('#createdvouchers').append(tableRows(data));
                    }
                });

                //This functionpopulates the tbody inner HTML with json data on call
                function drawRow(rowData) {
                    var row = $("<tr />")
                    row.append($('<td class="hidden"> + rowData.Id + </td>'));
                    row.append($("<td>" + rowData.CountyName + "</td>"));
                    row.append($("<td>" + rowData.CountyCode + "</td>"));

                    return row[0];
                }
            </script>
            <script type="text/JavaScript">
                //getting voucheCounties and do a count
                $(document).ready(function () {
                    var Count = $('#count');
                    $.ajax({
                        url: "https://voucherapi.kec.ac.ke/api/counties/count",
                        type: "GET",
                        dataType: "json",
                        success: function (data, status, jqhxr) {
                            console.log(data);
                            $('#count').html(data)
                        }
                    });
                }) ;
            </script>
            <script type="text/JavaScript">
                //getting voucheCounties and do a count
                $(document).ready(function () {
                    var Count = $('#types');
                    $.ajax({
                        url: "https://voucherapi.kec.ac.ke/api/schooltypes/count",
                        type: "GET",
                        dataType: "json",
                        success: function (data, status, jqhxr) {
                            console.log(data);
                            $('#types').html(data)
                        }
                    });
                }) ;
            </script>
            <script type="text/JavaScript">
                //getting voucheCounties and do a count
                $(document).ready(function () {
                    var Count = $('#batches');
                    $.ajax({
                        url: "https://voucherapi.kec.ac.ke/api/batches/count",
                        type: "GET",
                        dataType: "json",
                        success: function (data, status, jqhxr) {
                            console.log(data);
                            $('#batches').html(data)
                        }
                    });
                }) ;
            </script>
            <!--HAPPY CODDING TO YOU LAZZY TESTERS-->
        }

